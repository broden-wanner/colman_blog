{% extends 'base.html' %}

{% block content %}
	<div class="row">
		<div class="post">
			<h1>{{ post.title }} <small>by {{post.author}}</small></h1>
			<p>{{ post.text|linebreaksbr }}</p>
			{% if post.image %}
				<img src="{{ post.image.url }}" alt="Image for post {{ post.title }}" class="img-rounded img-responsive post-image">
			{% endif %}
			{% if post.youtube_video %}
				<iframe width="560" height="315" src="{{ post.embed_link }}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
			{% endif %}
			{% if post.published_date %}
				<p>Published: {{ post.published_date|date:"l, F jS, Y \a\t P" }}
					{% if post.edited_date %}
						| Edited: {{ post.edited_date|date:"l, F jS, Y \a\t P" }}</p>
					{% endif %}
			{% endif %}
			<!--Displays options for editing only if the author is the logged in user -->
			{% if user == post.author %}
				<div class="btn-group">
					<a class="btn btn-default" href="{% url 'edit' pk=post.pk %}">Edit Post</a>
					<a class="btn btn-default" href="{% url 'delete' pk=post.pk %}">Delete Post</a>
				</div>
			{% endif %}
		</div>
	</div>
	<hr>
	<!--New Comment Form-->
	<div class="combined-comment-section">
		<h3>Comments</h3>
		<p><strong>{{ user }}</strong></p>
		<div class="row">
			<form method="POST">
				<div class="form-group col-sm-10">
					{% csrf_token %}
					{{ create_comment_form.text.errors }}
					{{ create_comment_form.text }}
				</div>
				<button type="submit" class="btn btn-default col-sm-2" value="Post Comment">Comment</button>
			</form>
		</div>
		<!--Comment Section-->
		<div class="comment-section">
			{% if comments %}
				{% for comment in comments %}
					<div class="row">
						<p><strong>{{ comment.author }}
						{% if comment.edited %}
							(Edited)
						{% endif %}
						</strong> <small>{{ comment.time_since_post }}</small></p>
						<div class="col-sm-10">
							<p>{{ comment.text }}</p>
						</div>
						<div class="col-sm-2">
							{% if comment.author == user %}
								<a href="{% url 'edit_comment' pk=comment.pk %}" class="btn btn-default">Edit Comment</a>
							{% endif %}
						</div>
						<br><br>
					</div>
				{% endfor %}
			{% endif %}
		</div>
	</div>
	<!--Displays newer and older post buttons-->
	<hr>
	<div class="row">
		<ul class="pager">
			{% if older_post %}
				<li class="previous"><a href="{% url 'detail' pk=older_post.pk %}">Previous Post: {{ older_post }}</a></li>
			{% else %}
				<li class="previous disabled"><a href="#">No Older Posts</a></li>
			{% endif %}
			{% if newer_post %}
				<li class="next"><a href="{% url 'detail' pk=newer_post.pk %}">Next Post: {{ newer_post }}</a></li>
			{% else %}
				<li class="next disabled"><a href="#">No Newer Posts</a></li>
			{% endif %}
		</ul>
	</div>
{% endblock %}